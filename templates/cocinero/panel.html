<!-- frontend/interfaz/cocinero/panel.html -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Cocina</title>
    <link rel="stylesheet" href="/static/css/panel_cocinero.css">
</head>
<body>
    <h1>üë®‚Äçüç≥ Pedidos en Cocina</h1>
    <div id="pedidos-container"></div>

    <script>
        async function cargarPedidos() {
            const response = await fetch('/api/pedidos/en-cocina/');
            const pedidos = await response.json();

            const container = document.getElementById('pedidos-container');
            container.innerHTML = '';

            pedidos.forEach(p => {
                const card = document.createElement('div');
                card.className = 'pedido-card';
                card.innerHTML = `
                    <h3>Pedido #${p.id} - Mesa ${p.mesa}</h3>
                    <ul>
                        ${p.detalles.map(d => `<li>${d.cantidad} x ${d.producto.nombre}</li>`).join('')}
                    </ul>
                    <p>Estado: <strong>${p.estado}</strong></p>
                    ${p.estado !== 'listo' ? `
                        <button onclick="actualizarEstado(${p.id}, 'preparando')">Preparando</button>
                        <button onclick="actualizarEstado(${p.id}, 'listo')">Listo</button>
                    ` : ''}
                `;
                container.appendChild(card);
            });
        }

        async function actualizarEstado(pedidoId, nuevoEstado) {
            await fetch(`/api/pedidos/actualizar-estado/${pedidoId}/`, {
                method: 'PATCH',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ estado: nuevoEstado })
            });
            cargarPedidos();
        }

        cargarPedidos();
        setInterval(cargarPedidos, 10000); // refresca cada 10s
    </script>
</body>
</html>
